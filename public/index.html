
<html>
<head>
    <!-- Importing a-frame !-->
    <script src="aframe.min.js"></script>

    <!-- Importing other components !-->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.0/dist/aframe-extras.min.js"></script>
    <script src="assets/scripts/super-hands.min.js"></script>
    <script src="assets/scripts/aframe-physics-components.min.js"></script>
    <script src="assets/scripts/aframe-controller-cursor-component.min.js"></script>
    <script src="assets/scripts/aframe-physics-system.min.js"></script>
</head>
<body>
  <a-scene physics-world="gravity: 0 -3.8 0">
    <!-- We load the assets for the game !-->
    <a-assets>
      <!-- Background video !-->
      <video id="video" src="assets/background.mp4" autoplay loop muted crossorigin></video>

      <!-- Pickup assets !-->
      <a-asset-item id="pickup-obj" src="assets/models/pickup/pickup_truck.obj"></a-asset-item>
      <a-asset-item id="pickup-mtl" src="assets/models/pickup/pickup_truck.mtl"></a-asset-item>

      <!-- Zombie asset !-->
      <a-asset-item id="zombie-obj" src="assets/models/zombie/zombie_slow.obj"></a-asset-item>
      <a-asset-item id="zombie-mtl" src="assets/models/zombie/zombie_slow.mtl"></a-asset-item>

      <!-- Audio asset !-->
      <audio id="laserFire" src="assets/sounds/Laser-sound.mp3" preload="auto"></audio>
        
      <!-- rubix -->
      <a-asset-item id="rubix-obj" src="assets/models/rubix/RubixCube.obj"></a-asset-item>
      <a-asset-item id="rubix-mtl" src="assets/models/rubix/RubixCube.mtl"></a-asset-item>
    </a-assets>

     <!-- We add the controllers !-->
    <a-entity id="leftHand" position="0 2 -1" super-hands sphere-collider="objects: .throwable" grab hand-controls="left"></a-entity>
    <a-entity id="rightHand" position="0 2 -1" super-hands sphere-collider="objects: a-box" hand-controls="right" controller-cursor raycaster="objects: .pickable, .ennemy"></a-entity>

    <a-camera position="0 2 -1"></a-camera>
    <a-videosphere src="#video" rotation="0 90 0"></a-videosphere>
    <a-entity id="ground" geometry="primitive: box; depth: 50; height: 0.1; width: 30" material="color: #2E3837" physics-body="mass: 0; boundingBox: 50 0.1 50" position="0 0 -10" visible="false"></a-entity>

    <!-- Truck !-->
    <a-obj-model physics-body="boundingBox: 3 3 12; mass: 0; velocity: 0" position="0 0 3" src="#pickup-obj" mtl="#pickup-mtl"></a-obj-model>

    <!-- Zombie !-->
    <a-obj-model class="ennemy" physics-body="boundingBox: 1 1 1; mass: 5; velocity: 0.2 0 0" position="0 5 -5" scale="1.6 2 1.6" src="#zombie-obj" mtl="#zombie-mtl"></a-obj-model>

    <a-entity id="laserGun" class="pickable" scale="1 1 1" position="0.038 2.834 -2" object-model="src:url(assets/models/gun/ablast/gun.json)" rotation="60.07000000000001 0 0"></a-entity>
    <a-entity sound="src: #laserFire; poolSize: 2000;"></a-entity>

    <!-- Throwable object !-->
    <a-box hoverable clickable grabbable drag-droppable position="-1 2 -1" color="red"></a-box>
    
    

    <a-entity position="2 10 -20" text="width: 20; lineHeight: 100; letterSpacing: 5; color: red; value: Objection : Kill All Zombies."></a-entity>
   </a-scene>

  <!-- Browserified source !-->
  <!-- <script src="core/bundled.js"></script> -->

  <script type="text/javascript">
    window.addEventListener("load", function(){
      const SCENE             = document.querySelector("a-scene");
      const RIGHT_CONTROLLER  = document.querySelector("#rightHand");

      var pickedGun     = null;
      var targetEnnemy  = null;

      // Grab the gun
      RIGHT_CONTROLLER.addEventListener('click', function(evt) {
        if(evt.detail.intersectedEl === undefined) return; 
        if(evt.detail.intersectedEl.className !== "pickable") return;
        if(pickedGun !== null) return; 

        pickedGun = evt.detail.intersectedEl;
        SCENE.removeChild(pickedGun);
        RIGHT_CONTROLLER.appendChild(pickedGun);
        pickedGun.setAttribute("class", "");
        pickedGun.setAttribute("position", "0.013 0.005 -0.054");
        pickedGun.setAttribute("rotation", "-3.552 59.702 91.616");
      });

      // Define if the player is targeting a zombie
      RIGHT_CONTROLLER.addEventListener("mouseenter", function(evt) {
        if(evt.detail.intersectedEl === undefined) return;
        if(evt.detail.intersectedEl.className !== "ennemy") return;

        targetEnnemy = evt.detail.intersectedEl;
      })

      // Define if the player is no more targeting a zombie
      RIGHT_CONTROLLER.addEventListener("mouseleave", function(evt) {
        if(targetEnnemy === null) return;

        targetEnnemy = null;
      })

      // When player shoot, kill the zombie or do nothing;
      RIGHT_CONTROLLER.addEventListener('triggerdown', function(evt) {
        if(pickedGun === null) return; 

        document.querySelector('[sound]').components.sound.playSound();
        if(targetEnnemy === null) return;
        SCENE.removeChild(targetEnnemy);
        targetEnnemy = null;

        /*var bullet = document.createElement("a-sphere");
        bullet.setAttribute("color", "blue");
        bullet.setAttribute("radius", "0.030");
        bullet.setAttribute("position", AFRAME.utils.coordinates.stringify(RIGHT_CONTROLLER.components.position.data));
        bullet.setAttribute("radius", "0.02");
        SCENE.appendChild(bullet);
        bullet.setAttribute("dynamic-body", "mass: 0;");
        bullet.addEventListener('body-loaded', function(evt){
          var el = evt.detail.body;

          el.applyImpulse({ x: 10, y: 0, z: 0 }, { x: -1, y: 1, z: 0 });
        });*/
      })




    });
  </script>
</body>
</html>
